---
- name: Deploy Komodo Periphery
  community.docker.docker_container:
    name: komodo-periphery
    image: "ghcr.io/moghtech/komodo-periphery:{{ komodo_image_tag }}"
    state: started
    restart_policy: "{{ restart_policy }}"
    networks:
      - name: "{{ backend_network }}"
    env:
      TZ: "{{ timezone }}"
      PERIPHERY_ROOT_DIRECTORY: "{{ periphery_root_directory }}"
      PERIPHERY_PASSKEYS: "{{ komodo_passkey }}"
      PERIPHERY_SSL_ENABLED: "{{ periphery_ssl_enabled }}"
      PERIPHERY_DISABLE_TERMINALS: "{{ periphery_disable_terminals }}"
      PERIPHERY_INCLUDE_DISK_MOUNTS: "{{ periphery_include_disk_mounts }}"
      PERIPHERY_LOGGING_PRETTY: "{{ periphery_logging_pretty }}"
      PERIPHERY_PRETTY_STARTUP_CONFIG: "{{ periphery_pretty_startup_config }}"
    volumes:
      - /var/run/docker.sock:/var/run/docker.sock
      - /proc:/proc
      - "{{ periphery_root_directory }}:{{ periphery_root_directory }}"
      - "{{ docker_base_path }}:{{ docker_base_path }}"
    labels:
      komodo.skip: ""
    log_driver: "{{ logging_driver }}"
    log_options:
      max-size: "{{ logging_max_size }}"
      max-file: "{{ logging_max_file }}"
