---
- name: Deploy MongoDB
  community.docker.docker_container:
    name: mongo
    image: mongo:latest
    state: started
    restart_policy: "{{ restart_policy }}"
    command: "--quiet --wiredTigerCacheSizeGB 0.25"
    networks:
      - name: "{{ backend_network }}"
    volumes:
      - mongo-data:/data/db
      - mongo-config:/data/configdb
    labels:
      komodo.skip: ""  # Prevent Komodo from managing itself
    healthcheck:
      test: ["CMD", "mongosh", "--eval", "db.adminCommand('ping')"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s
    log_driver: "{{ logging_driver }}"
    log_options:
      max-size: "{{ logging_max_size }}"
      max-file: "{{ logging_max_file }}"
